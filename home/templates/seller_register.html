{% extends "base.html" %}
{% block title %}Seller Account Registration - G-Mart{% endblock %}
{% load static %}
{% block content %}
<style>
    :root {
        --primary-color: #2c7744;
        --primary-dark: #1e5c33;
        --secondary-color: #f8f9fa;
        --accent-color: #ff6b35;
        --text-dark: #333;
        --text-light: #6c757d;
        --border-color: #dee2e6;
        --success-color: #28a745;
        --error-color: #dc3545;
    }
    
    .seller-registration-container {
        background: linear-gradient(135deg, #f5f7fa 0%, #e4edf5 100%);
        min-height: 100vh;
        padding: 40px 20px;
    }
    
    .registration-card {
        max-width: 1000px;
        margin: 0 auto;
        background: white;
        border-radius: 20px;
        box-shadow: 0 15px 30px rgba(0, 0, 0, 0.1);
        overflow: hidden;
    }
    
    .registration-header {
        background: linear-gradient(135deg, var(--primary-color) 0%, var(--primary-dark) 100%);
        color: white;
        padding: 30px;
        text-align: center;
    }
    
    .registration-header h1 {
        font-size: 32px;
        margin-bottom: 10px;
        font-weight: 700;
    }
    
    .registration-header p {
        font-size: 16px;
        opacity: 0.9;
    }
    
    .registration-body {
        padding: 40px;
    }
    
    .form-section {
        margin-bottom: 40px;
        padding-bottom: 30px;
        border-bottom: 1px solid var(--border-color);
    }
    
    .form-section:last-of-type {
        border-bottom: none;
    }
    
    .section-title {
        font-size: 22px;
        color: var(--primary-color);
        margin-bottom: 25px;
        padding-bottom: 10px;
        border-bottom: 2px solid var(--primary-color);
        display: flex;
        align-items: center;
    }
    
    .section-title i {
        margin-right: 10px;
        font-size: 20px;
    }
    
    .form-grid {
        display: grid;
        grid-template-columns: 1fr 1fr;
        gap: 20px;
    }
    
    .form-group {
        margin-bottom: 20px;
    }
    
    .form-label {
        display: block;
        margin-bottom: 8px;
        font-weight: 600;
        color: var(--text-dark);
    }
    
    .required::after {
        content: " *";
        color: var(--error-color);
    }
    
    .form-control {
        width: 100%;
        padding: 12px 15px;
        border: 1px solid var(--border-color);
        border-radius: 10px;
        font-size: 16px;
        transition: all 0.3s ease;
    }
    
    .form-control:focus {
        outline: none;
        border-color: var(--primary-color);
        box-shadow: 0 0 0 3px rgba(44, 119, 68, 0.2);
    }
    
    .form-control.error {
        border-color: var(--error-color);
    }
    
    .error-message {
        color: var(--error-color);
        font-size: 14px;
        margin-top: 5px;
        display: none;
    }
    
    .form-text {
        font-size: 14px;
        color: var(--text-light);
        margin-top: 5px;
    }
    
    .file-upload-container {
        border: 2px dashed var(--border-color);
        border-radius: 10px;
        padding: 20px;
        text-align: center;
        transition: all 0.3s ease;
        cursor: pointer;
    }
    
    .file-upload-container:hover {
        border-color: var(--primary-color);
        background-color: rgba(44, 119, 68, 0.05);
    }
    
    .file-upload-container i {
        font-size: 40px;
        color: var(--primary-color);
        margin-bottom: 10px;
    }
    
    .file-input {
        display: none;
    }
    
    .file-name {
        margin-top: 10px;
        font-size: 14px;
        color: var(--text-light);
    }
    
    .checkbox-container {
        display: flex;
        align-items: flex-start;
        margin-bottom: 20px;
    }
    
    .checkbox-container input {
        margin-right: 10px;
        margin-top: 5px;
    }
    
    .terms-link {
        color: var(--primary-color);
        font-weight: 600;
        text-decoration: none;
    }
    
    .terms-link:hover {
        text-decoration: underline;
    }
    
    .submit-btn {
        background: linear-gradient(135deg, var(--primary-color) 0%, var(--primary-dark) 100%);
        color: white;
        border: none;
        padding: 15px 30px;
        font-size: 18px;
        font-weight: 600;
        border-radius: 10px;
        cursor: pointer;
        transition: all 0.3s ease;
        display: flex;
        align-items: center;
        justify-content: center;
        width: 100%;
        margin-top: 20px;
    }
    
    .submit-btn:hover {
        transform: translateY(-3px);
        box-shadow: 0 10px 20px rgba(44, 119, 68, 0.3);
    }
    
    .submit-btn i {
        margin-left: 10px;
    }
    
    .submit-btn:disabled {
        background: var(--text-light);
        cursor: not-allowed;
        transform: none;
        box-shadow: none;
    }
    
    .progress-container {
        margin-bottom: 30px;
    }
    
    .progress-bar {
        height: 8px;
        background-color: var(--border-color);
        border-radius: 4px;
        overflow: hidden;
    }
    
    .progress-fill {
        height: 100%;
        background: linear-gradient(135deg, var(--primary-color) 0%, var(--primary-dark) 100%);
        width: 0%;
        transition: width 0.5s ease;
    }
    
    .progress-text {
        text-align: center;
        margin-top: 10px;
        font-size: 14px;
        color: var(--text-light);
    }
    
    .verification-badge {
        display: inline-flex;
        align-items: center;
        background: rgba(40, 167, 69, 0.1);
        color: var(--success-color);
        padding: 5px 10px;
        border-radius: 20px;
        font-size: 14px;
        margin-left: 10px;
    }
    
    .verification-badge i {
        margin-right: 5px;
    }
    
    .alert {
        padding: 15px;
        margin-bottom: 20px;
        border-radius: 10px;
        font-weight: 500;
    }
    
    .alert-warning {
        background-color: #fff3cd;
        color: #856404;
        border: 1px solid #ffeaa7;
    }
    
    @media (max-width: 768px) {
        .form-grid {
            grid-template-columns: 1fr;
        }
        
        .registration-body {
            padding: 25px;
        }
        
        .registration-header {
            padding: 20px;
        }
        
        .registration-header h1 {
            font-size: 26px;
        }
    }
</style>

<div class="seller-registration-container">
    <div class="registration-card">
        <div class="registration-header">
            <h1><i class="fas fa-store"></i> Seller Registration</h1>
            <p>Join G-Mart as a seller and start growing your business</p>
        </div>
        
        <div class="registration-body">
            <!-- Progress Bar -->
            <div class="progress-container">
                <div class="progress-bar">
                    <div class="progress-fill" id="form-progress"></div>
                </div>
                <div class="progress-text">Form Completion: <span id="progress-text">0%</span></div>
            </div>
            
            <!-- Django Messages -->
            {% for message in messages %}
            <div class="alert alert-warning alert-dismissible fade show" role="alert">
                <strong>{{ message }}</strong>
                <button type="button" class="btn-close" data-bs-dismiss="alert" aria-label="Close"></button>
            </div>
            {% endfor %}
            
            <form method="POST" action="{% url 'seller_register_submit' %}" enctype="multipart/form-data" id="seller-registration-form">
                {% csrf_token %}
                
                <!-- Personal Information Section -->
                <div class="form-section">
                    <h3 class="section-title"><i class="fas fa-user"></i> Personal Information</h3>
                    
                    <div class="form-group">
                        <label for="full_name" class="form-label required">Full Name</label>
                        <input type="text" class="form-control" id="full_name" name="full_name" required>
                        <div class="error-message" id="full_name_error">Please enter your full name</div>
                    </div>
                    
                    <div class="form-grid">
                        <div class="form-group">
                            <label for="email" class="form-label required">Email Address</label>
                            <input type="email" class="form-control" id="email" name="email" required>
                            <div class="error-message" id="email_error">Please enter a valid email address</div>
                            <div class="form-text">We'll send a verification email to this address</div>
                        </div>
                        
                        <div class="form-group">
                            <label for="phone" class="form-label">Phone Number</label>
                            <input type="tel" class="form-control" id="phone" name="phone">
                            <div class="error-message" id="phone_error">Please enter a valid phone number</div>
                        </div>
                    </div>
                    
                    <div class="form-grid">
                        <div class="form-group">
                            <label for="password" class="form-label required">Password</label>
                            <input type="password" class="form-control" id="password" name="password" required>
                            <div class="error-message" id="password_error">Password must be at least 8 characters with uppercase, lowercase, and number</div>
                            <div class="form-text" id="password-strength"></div>
                        </div>
                        
                        <div class="form-group">
                            <label for="confirm_password" class="form-label required">Confirm Password</label>
                            <input type="password" class="form-control" id="confirm_password" name="confirm_password" required>
                            <div class="error-message" id="confirm_password_error">Passwords do not match</div>
                        </div>
                    </div>
                </div>
                
                <!-- Business Information Section -->
                <div class="form-section">
                    <h3 class="section-title"><i class="fas fa-building"></i> Business Information</h3>
                    
                    <div class="form-group">
                        <label for="store_name" class="form-label required">Store Name</label>
                        <input type="text" class="form-control" id="store_name" name="store_name" required>
                        <div class="error-message" id="store_name_error">Please enter your store name</div>
                        <div class="form-text">This will be displayed to customers</div>
                    </div>
                    
                    <div class="form-grid">
                        <div class="form-group">
                            <label for="business_type" class="form-label required">Business Type</label>
                            <select class="form-control" id="business_type" name="business_type" required>
                                <option value="">Select type</option>
                                <option value="sole_proprietor">Sole Proprietor</option>
                                <option value="private_company">Private Company</option>
                                <option value="partnership">Partnership</option>
                                <option value="other">Other</option>
                            </select>
                            <div class="error-message" id="business_type_error">Please select a business type</div>
                        </div>
                        
                        <div class="form-group">
                            <label for="tax_id" class="form-label">Registration / GST / Tax ID</label>
                            <input type="text" class="form-control" id="tax_id" name="tax_id">
                            <div class="error-message" id="tax_id_error">Please enter a valid tax ID</div>
                        </div>
                    </div>
                    
                    <div class="form-group">
                        <label for="address" class="form-label required">Business Address</label>
                        <textarea class="form-control" id="address" name="address" rows="2" required></textarea>
                        <div class="error-message" id="address_error">Please enter your business address</div>
                    </div>
                    
                    <div class="form-grid">
                        <div class="form-group">
                            <label for="city" class="form-label required">City</label>
                            <input type="text" class="form-control" id="city" name="city" required>
                            <div class="error-message" id="city_error">Please enter your city</div>
                        </div>
                        
                        <div class="form-group">
                            <label for="state" class="form-label required">State</label>
                            <input type="text" class="form-control" id="state" name="state" required>
                            <div class="error-message" id="state_error">Please enter your state</div>
                        </div>
                    </div>
                    
                    <div class="form-grid">
                        <div class="form-group">
                            <label for="postal_code" class="form-label required">Postal Code</label>
                            <input type="text" class="form-control" id="postal_code" name="postal_code" required>
                            <div class="error-message" id="postal_code_error">Please enter a valid postal code</div>
                        </div>
                        
                        <div class="form-group">
                            <label for="country" class="form-label required">Country</label>
                            <input type="text" class="form-control" id="country" name="country" value="India" required>
                            <div class="error-message" id="country_error">Please enter your country</div>
                        </div>
                    </div>
                </div>
                
                <!-- Bank & Payment Details -->
                <div class="form-section">
                    <h3 class="section-title"><i class="fas fa-credit-card"></i> Bank & Payment Details</h3>
                    
                    <div class="form-group">
                        <label for="bank_name" class="form-label required">Bank Name</label>
                        <input type="text" class="form-control" id="bank_name" name="bank_name" required>
                        <div class="error-message" id="bank_name_error">Please enter your bank name</div>
                    </div>
                    
                    <div class="form-grid">
                        <div class="form-group">
                            <label for="account_number" class="form-label required">Bank Account Number</label>
                            <input type="text" class="form-control" id="account_number" name="account_number" required>
                            <div class="error-message" id="account_number_error">Please enter a valid account number</div>
                        </div>
                        
                        <div class="form-group">
                            <label for="ifsc" class="form-label required">IFSC Code</label>
                            <input type="text" class="form-control" id="ifsc" name="ifsc" required>
                            <div class="error-message" id="ifsc_error">Please enter a valid IFSC code</div>
                        </div>
                    </div>
                    
                    <div class="form-group">
                        <label for="payment_email" class="form-label">Payment Gateway Email / UPI ID</label>
                        <input type="text" class="form-control" id="payment_email" name="payment_email">
                        <div class="error-message" id="payment_email_error">Please enter a valid email or UPI ID</div>
                    </div>
                </div>
                
                <!-- Verification Documents -->
                <div class="form-section">
                    <h3 class="section-title"><i class="fas fa-file-contract"></i> Verification Documents</h3>
                    
                    <div class="form-group">
                        <label class="form-label">Business Registration Document</label>
                        <div class="file-upload-container" id="business-doc-container">
                            <i class="fas fa-file-upload"></i>
                            <p>Click to upload business registration document</p>
                            <p class="form-text">Accepted: PDF, JPG, PNG (Max 5MB)</p>
                            <input type="file" class="file-input" id="business_document" name="business_document" accept=".pdf,.jpg,.jpeg,.png">
                            <div class="file-name" id="business-doc-name"></div>
                        </div>
                        <div class="error-message" id="business_document_error">Please upload a valid document</div>
                    </div>
                    
                    <div class="form-group">
                        <label class="form-label required">Identity Proof (ID Card / Passport)</label>
                        <div class="file-upload-container" id="identity-doc-container">
                            <i class="fas fa-id-card"></i>
                            <p>Click to upload identity proof</p>
                            <p class="form-text">Accepted: PDF, JPG, PNG (Max 5MB)</p>
                            <input type="file" class="file-input" id="identity_proof" name="identity_proof" accept=".pdf,.jpg,.jpeg,.png" required>
                            <div class="file-name" id="identity-doc-name"></div>
                        </div>
                        <div class="error-message" id="identity_proof_error">Please upload a valid identity proof</div>
                    </div>
                </div>
                
                <!-- Terms & Conditions -->
                <div class="form-section">
                    <div class="checkbox-container">
                        <input type="checkbox" id="agree_terms" name="agree_terms" required>
                        <label for="agree_terms">
                            I agree to the <a href="{% url 'terms' %}" target="_blank" class="terms-link">Terms & Conditions</a> and 
                            <a href="#" target="_blank" class="terms-link">Privacy Policy</a> of G-Mart
                        </label>
                    </div>
                    <div class="error-message" id="agree_terms_error">You must agree to the terms and conditions</div>
                </div>
                
                <button type="submit" class="submit-btn" id="submit-btn">
                    <i class="fas fa-check-circle"></i> Complete Registration
                </button>
            </form>
        </div>
    </div>
</div>

<!-- Font Awesome for icons -->
<script src="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/js/all.min.js"></script>

<script>
    document.addEventListener('DOMContentLoaded', function() {
        const form = document.getElementById('seller-registration-form');
        const progressFill = document.getElementById('form-progress');
        const progressText = document.getElementById('progress-text');
        const submitBtn = document.getElementById('submit-btn');
        
        // File upload handlers
        setupFileUpload('business_document', 'business-doc-container', 'business-doc-name');
        setupFileUpload('identity_proof', 'identity-doc-container', 'identity-doc-name');
        
        // Form validation
        setupFormValidation();
        
        // Progress calculation
        calculateProgress();
        
        // Real-time validation
        form.addEventListener('input', function() {
            calculateProgress();
            validateField(event.target);
        });
        
        // Form submission
        form.addEventListener('submit', function(e) {
            if (!validateForm()) {
                e.preventDefault();
                alert('Please fix the errors before submitting the form.');
            }
        });
        
        function setupFileUpload(inputId, containerId, fileNameId) {
            const fileInput = document.getElementById(inputId);
            const container = document.getElementById(containerId);
            const fileName = document.getElementById(fileNameId);
            
            container.addEventListener('click', function() {
                fileInput.click();
            });
            
            fileInput.addEventListener('change', function() {
                if (fileInput.files.length > 0) {
                    fileName.textContent = fileInput.files[0].name;
                    validateFile(fileInput);
                } else {
                    fileName.textContent = '';
                }
                calculateProgress();
            });
        }
        
        function setupFormValidation() {
            // Add event listeners for real-time validation
            const requiredFields = form.querySelectorAll('[required]');
            requiredFields.forEach(field => {
                field.addEventListener('blur', function() {
                    validateField(this);
                });
            });
            
            // Password strength indicator
            const passwordField = document.getElementById('password');
            passwordField.addEventListener('input', function() {
                checkPasswordStrength(this.value);
            });
        }
        
        function validateField(field) {
            const errorElement = document.getElementById(field.id + '_error');
            
            if (field.type === 'file') {
                validateFile(field);
                return;
            }
            
            if (field.hasAttribute('required') && !field.value.trim()) {
                showError(field, errorElement, 'This field is required');
                return false;
            }
            
            // Email validation
            if (field.type === 'email' && field.value) {
                const emailRegex = /^[^\s@]+@[^\s@]+\.[^\s@]+$/;
                if (!emailRegex.test(field.value)) {
                    showError(field, errorElement, 'Please enter a valid email address');
                    return false;
                }
            }
            
            // Password validation
            if (field.id === 'password' && field.value) {
                if (!isStrongPassword(field.value)) {
                    showError(field, errorElement, 'Password must be at least 8 characters with uppercase, lowercase, and number');
                    return false;
                }
            }
            
            // Confirm password validation
            if (field.id === 'confirm_password' && field.value) {
                const password = document.getElementById('password').value;
                if (field.value !== password) {
                    showError(field, errorElement, 'Passwords do not match');
                    return false;
                }
            }
            
            // IFSC code validation (basic)
            if (field.id === 'ifsc' && field.value) {
                const ifscRegex = /^[A-Z]{4}0[A-Z0-9]{6}$/;
                if (!ifscRegex.test(field.value.toUpperCase())) {
                    showError(field, errorElement, 'Please enter a valid IFSC code');
                    return false;
                }
            }
            
            // Clear error
            hideError(field, errorElement);
            return true;
        }
        
        function validateFile(fileInput) {
            const errorElement = document.getElementById(fileInput.id + '_error');
            
            if (fileInput.hasAttribute('required') && fileInput.files.length === 0) {
                showError(fileInput, errorElement, 'This file is required');
                return false;
            }
            
            if (fileInput.files.length > 0) {
                const file = fileInput.files[0];
                const validTypes = ['image/jpeg', 'image/jpg', 'image/png', 'application/pdf'];
                const maxSize = 5 * 1024 * 1024; // 5MB
                
                if (!validTypes.includes(file.type)) {
                    showError(fileInput, errorElement, 'File type not supported. Please upload PDF, JPG, or PNG');
                    return false;
                }
                
                if (file.size > maxSize) {
                    showError(fileInput, errorElement, 'File size too large. Maximum 5MB allowed');
                    return false;
                }
            }
            
            hideError(fileInput, errorElement);
            return true;
        }
        
        function checkPasswordStrength(password) {
            const strengthText = document.getElementById('password-strength');
            let strength = 0;
            let feedback = '';
            
            if (password.length >= 8) strength++;
            if (/[A-Z]/.test(password)) strength++;
            if (/[a-z]/.test(password)) strength++;
            if (/[0-9]/.test(password)) strength++;
            if (/[^A-Za-z0-9]/.test(password)) strength++;
            
            switch(strength) {
                case 0:
                case 1:
                case 2:
                    feedback = '<span style="color: #dc3545;">Weak password</span>';
                    break;
                case 3:
                case 4:
                    feedback = '<span style="color: #ffc107;">Medium strength</span>';
                    break;
                case 5:
                    feedback = '<span style="color: #28a745;">Strong password</span>';
                    break;
            }
            
            strengthText.innerHTML = feedback;
        }
        
        function isStrongPassword(password) {
            return password.length >= 8 && 
                   /[A-Z]/.test(password) && 
                   /[a-z]/.test(password) && 
                   /[0-9]/.test(password);
        }
        
        function validateForm() {
            let isValid = true;
            const requiredFields = form.querySelectorAll('[required]');
            
            requiredFields.forEach(field => {
                if (!validateField(field)) {
                    isValid = false;
                }
            });
            
            // Special validation for password confirmation
            const password = document.getElementById('password').value;
            const confirmPassword = document.getElementById('confirm_password').value;
            if (password !== confirmPassword) {
                const errorElement = document.getElementById('confirm_password_error');
                showError(document.getElementById('confirm_password'), errorElement, 'Passwords do not match');
                isValid = false;
            }
            
            return isValid;
        }
        
        function showError(field, errorElement, message) {
            field.classList.add('error');
            errorElement.textContent = message;
            errorElement.style.display = 'block';
        }
        
        function hideError(field, errorElement) {
            field.classList.remove('error');
            errorElement.style.display = 'none';
        }
        
        function calculateProgress() {
            const requiredFields = form.querySelectorAll('[required]');
            let filledCount = 0;
            
            requiredFields.forEach(field => {
                if (field.type === 'checkbox') {
                    if (field.checked) filledCount++;
                } else if (field.type === 'file') {
                    if (field.files.length > 0) filledCount++;
                } else {
                    if (field.value.trim() !== '') filledCount++;
                }
            });
            
            const progress = Math.round((filledCount / requiredFields.length) * 100);
            progressFill.style.width = progress + '%';
            progressText.textContent = progress + '%';
            
            // Update button text based on progress
            if (progress === 100) {
                submitBtn.innerHTML = '<i class="fas fa-check-circle"></i> Complete Registration';
            } else {
                submitBtn.innerHTML = `<i class="fas fa-paper-plane"></i> Submit (${progress}% Complete)`;
            }
        }
    });
</script>
{% endblock %}