{% load static %}
<!DOCTYPE html>
<html lang="en">

<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>G-mart • {% block title %}{% endblock %}</title>
  <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet" />
  <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css" rel="stylesheet" />
  <link rel="stylesheet" href="{% static 'style.css' %}">
  <link rel="icon" href="/static/img/g-mart.jpg" />
  <style>
    :root {
      --primary-color: #7ed957;
      --secondary-color: #9E9BFF;
      --accent-color: #ff416c;
      --dark-bg: #1a1a2e;
      --card-bg: #16213e;
      --text-light: #ffffff;
      --text-muted: #b0b0b0;
    }

    body {
      background: linear-gradient(135deg, var(--dark-bg), #0f3460);
      color: var(--text-light);
      font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
      min-height: 100vh;
      overflow-x: hidden;
    }

    /* Navbar Styles */
    .navbar {
      background: rgba(26, 26, 46, 0.95);
      backdrop-filter: blur(15px);
      border-bottom: 1px solid rgba(255, 255, 255, 0.1);
      padding: 15px 0;
      transition: all 0.3s ease;
    }

    .navbar-brand {
      font-weight: 800;
      font-size: 2rem;
      background: linear-gradient(45deg, var(--primary-color), var(--secondary-color));
      -webkit-background-clip: text;
      -webkit-text-fill-color: transparent;
      transition: all 0.3s ease;
    }

    .navbar-brand:hover {
      transform: scale(1.05);
    }

    .nav-link {
      color: var(--text-light) !important;
      font-weight: 500;
      margin: 0 10px;
      padding: 8px 16px !important;
      border-radius: 25px;
      transition: all 0.3s ease;
      position: relative;
    }

    .nav-link:hover {
      background: rgba(126, 217, 87, 0.1);
      transform: translateY(-2px);
    }

    .nav-link::after {
      content: '';
      position: absolute;
      bottom: 0;
      left: 50%;
      width: 0;
      height: 2px;
      background: var(--primary-color);
      transition: all 0.3s ease;
      transform: translateX(-50%);
    }

    .nav-link:hover::after {
      width: 80%;
    }

    /* Dropdown Styles */
    .dropdown-menu {
      background: var(--card-bg);
      border: 1px solid rgba(255, 255, 255, 0.1);
      border-radius: 15px;
      box-shadow: 0 8px 32px rgba(0, 0, 0, 0.3);
    }

    .dropdown-item {
      color: var(--text-light);
      padding: 10px 20px;
      transition: all 0.3s ease;
    }

    .dropdown-item:hover {
      background: rgba(126, 217, 87, 0.2);
      color: var(--primary-color);
    }

    /* Search Form */
    .search-form {
      max-width: 400px;
      margin: 0 auto;
    }

    .search-form .form-control {
      background: rgba(255, 255, 255, 0.1);
      border: 1px solid rgba(255, 255, 255, 0.2);
      border-radius: 25px;
      color: var(--text-light);
      padding: 12px 20px;
      backdrop-filter: blur(10px);
    }

    .search-form .form-control::placeholder {
      color: var(--text-muted);
    }

    .search-form .btn {
      background: var(--primary-color);
      border: none;
      border-radius: 25px;
      padding: 12px 25px;
      margin-left: 10px;
      transition: all 0.3s ease;
    }

    .search-form .btn:hover {
      background: #6bc04a;
      transform: scale(1.05);
    }

    /* Icon Styles */
    .nav-icon {
      font-size: 1.5rem;
      color: var(--text-light);
      transition: all 0.3s ease;
      position: relative;
    }

    .nav-icon:hover {
      color: var(--primary-color);
      transform: scale(1.1);
    }

    .user-icon {
      color: var(--primary-color);
    }

    /* Cart Button */
    .cart-btn {
      background: linear-gradient(45deg, var(--primary-color), var(--secondary-color));
      border: none;
      border-radius: 25px;
      padding: 10px 20px;
      color: white;
      font-weight: 600;
      transition: all 0.3s ease;
      position: relative;
    }

    .cart-btn:hover {
      transform: translateY(-2px);
      box-shadow: 0 8px 20px rgba(126, 217, 87, 0.3);
    }

    .badge {
      font-size: 0.7rem;
      animation: pulse 2s infinite;
    }

    @keyframes pulse {
      0% { transform: scale(1); }
      50% { transform: scale(1.1); }
      100% { transform: scale(1); }
    }

    /* Offcanvas Styles */
    .offcanvas {
      background: var(--card-bg);
      color: var(--text-light);
    }

    .offcanvas-header {
      border-bottom: 1px solid rgba(255, 255, 255, 0.1);
      background: rgba(26, 26, 46, 0.8);
    }

    .offcanvas-title {
      color: var(--primary-color);
      font-weight: 700;
    }

    .btn-close {
      filter: invert(1);
    }

    /* Table Styles */
    .table {
      color: var(--text-light);
      border-color: rgba(255, 255, 255, 0.1);
    }

    .table thead {
      background: linear-gradient(45deg, var(--accent-color), #ff4b2b);
    }

    .table tbody tr {
      transition: all 0.3s ease;
    }

    .table tbody tr:hover {
      background: rgba(255, 255, 255, 0.05);
      transform: translateX(5px);
    }

    /* Notification Styles */
    .notification-alert {
      background: linear-gradient(45deg, #667eea, #764ba2);
      border: none;
      border-radius: 10px;
      color: white;
      padding: 15px;
      margin: 10px 0;
    }

    /* Footer Styles */
    footer {
      background: rgba(26, 26, 46, 0.9);
      border-top: 1px solid rgba(255, 255, 255, 0.1);
      margin-top: auto;
      position: relative;
    }

    .back-to-top {
      background: var(--primary-color);
      color: white;
      width: 50px;
      height: 50px;
      border-radius: 50%;
      display: flex;
      align-items: center;
      justify-content: center;
      transition: all 0.3s ease;
    }

    .back-to-top:hover {
      transform: translateY(-3px);
      background: #6bc04a;
    }

    /* Responsive Design */
    @media (max-width: 768px) {
      .navbar-brand {
        font-size: 1.5rem;
      }
      
      .search-form {
        margin: 15px 0;
      }
      
      .nav-link {
        margin: 5px 0;
        text-align: center;
      }
    }

    /* Custom Scrollbar */
    ::-webkit-scrollbar {
      width: 8px;
    }

    ::-webkit-scrollbar-track {
      background: var(--dark-bg);
    }

    ::-webkit-scrollbar-thumb {
      background: var(--primary-color);
      border-radius: 10px;
    }

    ::-webkit-scrollbar-thumb:hover {
      background: #6bc04a;
    }

    /* Main Content */
    main {
      min-height: calc(100vh - 200px);
    }



    /* notifictioan css  */

    /* Notification dropdown styling */
.notification-dropdown {
    width: 400px !important;
}

.notification-item {
    transition: all 0.2s ease;
}

.notification-item:hover {
    background-color: #f8f9fa;
    transform: translateX(2px);
}

.notification-image {
    width: 60px;
    height: 60px;
    object-fit: cover;
    border-radius: 8px;
    border: 2px solid #e9ecef;
}

.notification-badge {
    font-size: 0.7rem;
}

/* Scrollbar styling for dropdown */
.dropdown-menu::-webkit-scrollbar {
    width: 6px;
}

.dropdown-menu::-webkit-scrollbar-track {
    background: #f1f1f1;
    border-radius: 3px;
}

.dropdown-menu::-webkit-scrollbar-thumb {
    background: #c1c1c1;
    border-radius: 3px;
}

.dropdown-menu::-webkit-scrollbar-thumb:hover {
    background: #a8a8a8;
}
  </style>
</head>

<body class="d-flex flex-column min-vh-100">
  <!-- Navigation -->
  <nav class="navbar navbar-expand-lg navbar-dark fixed-top">
    <div class="container">
      <!-- Logo and User -->
      <div class="d-flex align-items-center">
        <i class="fa-regular fa-user nav-icon user-icon me-3" 
           data-bs-toggle="offcanvas" 
           data-bs-target="#offcanvasWithBothOptions"
           aria-controls="offcanvasWithBothOptions"></i>
        
        <a class="navbar-brand" href="/">
          <span>G-</span>Mart
        </a>
      </div>

      <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navMenu">
        <span class="navbar-toggler-icon"></span>
      </button>

      <!-- Navigation Menu -->
      <div class="collapse navbar-collapse" id="navMenu">
        <ul class="navbar-nav mx-auto">
          <li class="nav-item">
            <a class="nav-link" href="/">Home</a>
          </li>
          <li class="nav-item">
            <a class="nav-link" href="{% url 'cart' %}">Cart</a>
          </li>
          <li class="nav-item">
            <a class="nav-link" href="{% url 'order_history' %}">Orders</a>
          </li>
          
          <!-- Seller/Buyer Dropdown -->
          <li class="nav-item dropdown">
            <a class="nav-link dropdown-toggle" href="#" id="sellerDropdown" role="button" data-bs-toggle="dropdown">
              <i class="fas fa-users me-1"></i>Account
            </a>
            <ul class="dropdown-menu">
              <li><a class="dropdown-item" href="{% url 'seller_registration' %}">
                <i class="fas fa-store me-2"></i>Register as Seller
              </a></li>
             
              <li><a class="dropdown-item" href="{% url 'login' %}">
                <i class="fas fa-sign-in-alt me-2"></i>User Login
              </a></li>
            </ul>
          </li>

          <li class="nav-item">
            <a class="nav-link" href="{% url 'contact' %}">Contact</a>
          </li>
        </ul>

        <!-- Search Form -->
        <form class="search-form d-flex" method="GET" action="">
          <input class="form-control me-2" type="search" name="search" placeholder="Search products..." required>
          <button class="btn" type="submit">
            <i class="fas fa-search"></i>
          </button>
        </form>
      </div>

      <!-- Notification and Cart -->
      <div class="d-flex align-items-center">
  

<!-- Notification Bell -->  
<li class="nav-item dropdown">
    <a class="nav-link position-relative" href="#" id="notificationDropdown" role="button" 
       data-bs-toggle="dropdown" aria-expanded="false">
        <i class="fas fa-bell"></i>
        {% if unread_notification_count > 0 %}
        <span class="position-absolute top-0 start-100 translate-middle badge rounded-pill bg-danger" 
              id="notification-count">
            {{ unread_notification_count }}
        </span>
        {% endif %}
    </a>
    <ul class="dropdown-menu dropdown-menu-end" aria-labelledby="notificationDropdown" 
        style="width: 400px; max-height: 500px; overflow-y: auto;">
        <li class="dropdown-header">
            <strong>Notifications</strong>
            {% if request.user.is_authenticated and recent_notifications %}
            <a href="{% url 'mark_all_read' %}" class="float-end small text-primary">Mark all read</a>
            {% endif %}
        </li>
        <div id="notification-list">
            {% if request.user.is_authenticated %}
                {% for notification in recent_notifications %}
                <li>
                    <a class="dropdown-item {% if not notification.is_read %}bg-light{% endif %} p-3" 
                       href="{% if notification.product %}{% url 'product_detail' pk=notification.product.id %}{% else %}#{% endif %}">
                        <div class="d-flex align-items-start">
                            <!-- Product Image -->
                            <div class="flex-shrink-0 me-3">
                                {% if notification.product and notification.product.prod_images.first %}
                                    <img src="{{ notification.product.prod_images.first.image.url }}" 
                                         alt="{{ notification.product.name }}"
                                         class="rounded" 
                                         style="width: 60px; height: 60px; object-fit: cover;">
                                {% else %}
                                    <div class="bg-secondary rounded d-flex align-items-center justify-content-center"
                                         style="width: 60px; height: 60px;">
                                        <i class="fas fa-image text-white-50"></i>
                                    </div>
                                {% endif %}
                            </div>
                            
                            <!-- Notification Content -->
                            <div class="flex-grow-1">
                                <div class="d-flex justify-content-between align-items-start mb-1">
                                    <h6 class="mb-0 text-white">{{ notification.title }}</h6>
                                    {% if not notification.is_read %}
                                    <span class="badge bg-primary ms-2 text-white">New</span>
                                    {% endif %}
                                </div>
                                
                                <p class="mb-1 small text-white">{{ notification.message|truncatechars:40 }}</p>
                                
                                <!-- Product Info (if available) -->
                                {% if notification.product %}
                                <div class="product-info mt-2">
                                    <div class="d-flex justify-content-between align-items-center">
                                        <small class="text-success fw-bold">₹{{ notification.product.price }}</small>
                                        <small class="text-white">
                                            <i class="fas fa-store me-1"></i>
                                            {{ notification.product.seller.store_name }}
                                        </small>
                                    </div>
                                </div>
                                {% endif %}
                                
                                <small class="text-white">
                                    <i class="fas fa-clock me-1"></i>
                                    {{ notification.created_at|timesince }} ago
                                </small>
                            </div>
                        </div>
                    </a>
                </li>
                {% if not forloop.last %}
                <li><hr class="dropdown-divider my-2"></li>
                {% endif %}
                {% empty %}
                <li class="dropdown-item text-center text-white py-4">
                    <i class="fas fa-bell-slash fa-3x mb-3 text-white"></i>
                    <p class="mb-0">No notifications yet</p>
                    <small>When you get notifications, they'll appear here</small>
                </li>
                {% endfor %}
            {% else %}
                <li class="dropdown-item text-center text-white py-4">
                    <i class="fas fa-user-lock fa-2x mb-2"></i>
                    <p class="mb-0">Please login to see notifications</p>
                </li>
            {% endif %}
        </div>
        <li><hr class="dropdown-divider"></li>
        <li>
            <a class="dropdown-item text-center text-primary py-2" href="{% url 'all_notifications' %}">
                <i class="fas fa-list me-1"></i>View All Notifications
            </a>
        </li>
    </ul>
</li>

        <!-- Cart -->
        <a href="#" class="cart-btn position-relative" data-bs-toggle="offcanvas" data-bs-target="#offcanvasRight">
          <i class="fas fa-shopping-cart me-2"></i>
          Cart
          {% if cart_item_count > 0 %}
          <span class="position-absolute top-0 start-100 translate-middle badge bg-danger">
            {{ cart_item_count }}
          </span>
          {% endif %}
        </a>
      </div>
    </div>
  </nav>

  <!-- User Offcanvas -->
  <div class="offcanvas offcanvas-start" data-bs-scroll="true" tabindex="-1" id="offcanvasWithBothOptions">
    <div class="offcanvas-header">
      <h5 class="offcanvas-title">
        <i class="fas fa-user-circle me-2"></i>
        {% if user.is_authenticated %}
        Hello, <span class="text-primary">{{ user.username }}</span>
        {% else %}
        Welcome Guest
        {% endif %}
      </h5>
      <button type="button" class="btn-close" data-bs-dismiss="offcanvas"></button>
    </div>
    <div class="offcanvas-body">
      {% if user.is_authenticated %}
      <div class="d-grid gap-2">
        <a href="{% url 'profile' %}" class="btn btn-outline-primary">
          <i class="fas fa-user me-2"></i>My Profile
        </a>
        <a href="{% url 'logout' %}" class="btn btn-outline-danger">
          <i class="fas fa-sign-out-alt me-2"></i>Logout
        </a>
      </div>
      {% else %}
      <div class="d-grid gap-2">
        <a href="{% url 'login' %}" class="btn btn-primary">
          <i class="fas fa-sign-in-alt me-2"></i>Login
        </a>
        <a href="{% url 'buyer_register' %}" class="btn btn-outline-primary">
          <i class="fas fa-user-plus me-2"></i>Register
        </a>
      </div>
      {% endif %}
      
      <hr>
      <div class="mt-3">
        <h6>Quick Links</h6>
        <ul class="list-unstyled">
          <li><a href="{% url 'order_history' %}" class="text-decoration-none text-light">
            <i class="fas fa-history me-2"></i>Order History
          </a></li>
          <li><a href="{% url 'contact' %}" class="text-decoration-none text-light">
            <i class="fas fa-headset me-2"></i>Support
          </a></li>
        </ul>
      </div>
    </div>
  </div>

  <!-- Cart Offcanvas -->
  <div class="offcanvas offcanvas-end" tabindex="-1" id="offcanvasRight">
    <div class="offcanvas-header">
      <h5 class="offcanvas-title">
        <i class="fas fa-shopping-cart me-2"></i>Your Cart
      </h5>
      <button type="button" class="btn-close" data-bs-dismiss="offcanvas"></button>
    </div>
    <div class="offcanvas-body">
      {% if items %}
      <div class="table-responsive">
        <table class="table table-hover">
          <thead>
            <tr>
              <th>Product</th>
              <th>Qty</th>
              <th>Price</th>
              <th>Action</th>
            </tr>
          </thead>
          <tbody>
            {% for item in items %}
            <tr>
              <td>{{ item.product.name|truncatewords:3 }}</td>
              <td>
                <form method="POST" action="{% url 'update_cart_item' item.id %}" class="d-inline">
                  {% csrf_token %}
                  <input type="number" name="quantity" min="1" value="{{ item.quantity }}" 
                         class="form-control form-control-sm" style="width: 70px;">
              </td>
              <td>₹{{ item.product.price }}</td>
              <td>
                <div class="btn-group">
                  <button type="submit" class="btn btn-sm btn-primary">Update</button>
                  </form>
                  <a href="{% url 'remove_from_cart' item.id %}" class="btn btn-sm btn-danger">Remove</a>
                </div>
              </td>
            </tr>
            {% endfor %}
          </tbody>
        </table>
      </div>
      <div class="border-top pt-3">
        <h5 class="text-end">Total: ₹{{ total }}</h5>
        <a href="{% url 'checkout' %}" class="btn btn-success w-100">
          <i class="fas fa-credit-card me-2"></i>Checkout
        </a>
      </div>
      {% else %}
      <div class="text-center py-5">
        <i class="fas fa-shopping-cart fa-3x text-muted mb-3"></i>
        <p class="text-muted">Your cart is empty</p>
        <a href="/" class="btn btn-primary">Start Shopping</a>
      </div>
      {% endif %}
    </div>
  </div>



  <!-- Main Content -->
  <main class="flex-grow-1" style="padding-top: 100px;">
    {% block content %}
    {% endblock %}
  </main>

  <!-- Footer -->
  <footer class="navbar text-white py-4 mt-5">
    <div class="container text-center">
      <p class="mb-2">&copy; 2025 G-mart. All Rights Reserved.</p>
      <p class="small mb-3">
        Follow us:
        <a href="https://www.facebook.com/rahullswami01" class="text-white mx-2">
          <i class="fab fa-facebook-f"></i>
        </a>
        <a href="https://www.linkedin.com/in/rahullswami/" class="text-white mx-2">
          <i class="fab fa-linkedin-in"></i>
        </a>
        <a href="https://www.instagram.com/rahullswami_/" class="text-white mx-2">
          <i class="fab fa-instagram"></i>
        </a>
      </p>
      <div class="small text-white">
        <a href="#" class="text-white text-decoration-none me-3">Privacy Policy</a>
        <a href="#" class="text-white text-decoration-none me-3">Terms of Service</a>
        <a href="#" class="text-white text-decoration-none">Contact Support</a>
      </div>
    </div>
    <a href="#" class="back-to-top">
      <i class="fas fa-arrow-up"></i>
    </a>
  </footer>

  <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0-alpha1/dist/js/bootstrap.bundle.min.js"></script>
  <script>
    // Back to top functionality
    document.querySelector('.back-to-top').addEventListener('click', function(e) {
      e.preventDefault();
      window.scrollTo({ top: 0, behavior: 'smooth' });
    });

    // Navbar scroll effect
    window.addEventListener('scroll', function() {
      const navbar = document.querySelector('.navbar');
      if (window.scrollY > 100) {
        navbar.style.background = 'rgba(26, 26, 46, 0.98)';
        navbar.style.padding = '10px 0';
      } else {
        navbar.style.background = 'rgba(26, 26, 46, 0.95)';
        navbar.style.padding = '15px 0';
      }
    });



    // Real-time notification updates
function setupNotificationPolling() {
    setInterval(() => {
        if (document.hidden) return; // Tab active hai tabhi check karein
        
        fetch('/notifications/unread-count/')
            .then(response => response.json())
            .then(data => {
                const countElement = document.getElementById('notification-count');
                if (countElement) {
                    const currentCount = parseInt(countElement.textContent) || 0;
                    if (data.count !== currentCount) {
                        countElement.textContent = data.count;
                        countElement.style.display = data.count > 0 ? 'block' : 'none';
                        
                        // Agar new notification aayi hai to notification sound play karein
                        if (data.count > currentCount) {
                            playNotificationSound();
                        }
                    }
                }
            });
    }, 30000); // 30 seconds mein check karein
}

function playNotificationSound() {
    // Simple notification sound
    const audio = new Audio('data:audio/wav;base64,UklGRigAAABXQVZFZm10IBAAAAABAAEARKwAAIhYAQACABAAZGF0YQQAAAAAAA==');
    audio.volume = 0.3;
    audio.play().catch(e => console.log('Audio play failed:', e));
}

// Jab page load ho tab polling start karein
document.addEventListener('DOMContentLoaded', function() {
    setupNotificationPolling();
});
  </script>
</body>

</html>